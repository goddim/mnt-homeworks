# Домашнее задание к занятию "13.Системы мониторинга"

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. 
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?№№
## Ответ 1
CPU Utilization (Использование ЦПУ): Метрика позволяет отслеживать процент использования вычислительных ресурсов процессора. Поскольку вычисления загружают ЦПУ, это ключевая метрика для определения его загруженности.
Memory Utilization (Использование памяти): Это позволит отслеживать, насколько интенсивно используется оперативная память на сервере. При интенсивных вычислениях может возникнуть нехватка оперативной памяти, что может привести к сбоям или падению производительности.
HTTP Response Time (Время ответа HTTP): Метрика позволяет оценить скорость ответа сервера на запросы клиентов. Поскольку взаимодействие с платформой осуществляется по протоколу HTTP, важно отслеживать время ответа для обеспечения хорошего качества обслуживания.
Throughput (Пропускная способность): Данная метрика позволяет оценить количество запросов, обрабатываемых сервером за определенный период времени. Это поможет понять нагрузку на систему и оценить ее производительность.
Причина выбора этих метрик заключается в том, что они позволяют оценить ключевые аспекты производительности и доступности системы, а также предупредить о возможных проблемах, таких как перегрузка ЦПУ или нехватка памяти.

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?
   
## Ответ 2
Предоставление понятной и наглядной отчетности: Вместо технических метрик можно предоставить менеджеру продукта отчеты и дашборды, которые отображают ключевые показатели производительности и доступности сервиса в более понятной форме. Это могут быть, например, графики времени ответа сервера, процент успешных запросов или количество активных пользователей.
Мониторинг уровня сервиса (SLA): Вместо обсуждения технических метрик можно предложить обсудить с менеджером продукта параметры SLA, которые он хотел бы отслеживать. Это может быть, например, процент успешных запросов, среднее время ответа сервера или время восстановления после сбоев.
Обсуждение ключевых моментов и проблем: Важно уделить время на обсуждение ключевых моментов и проблем, которые могут влиять на качество обслуживания. Это позволит менеджеру продукта более глубоко понять текущее состояние сервиса и принимать информированные решения.
Привлечение бизнес-метрик: В дополнение к техническим метрикам можно также обсудить с менеджером продукта бизнес-метрики, которые отражают успешность проекта с точки зрения бизнеса. Это могут быть, например, показатели конверсии, удержания клиентов или выручки.
Обучение и консультации: Предложите менеджеру продукта краткое обучение или консультации по основам мониторинга и ключевым метрикам производительности, чтобы он мог лучше понимать предоставляемую информацию и принимать обоснованные решения.
Этот подход позволит менеджеру продукта эффективно оценивать качество обслуживания и принимать информированные решения на основе доступной отчетности и аналитики, не вдаваясь в технические детали.

3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?
## Ответ 3
В случае, когда не выделено финансирование на построение системы сбора логов, для обеспечения доступа к ошибкам приложения для разработчиков можно использовать следующее решение:
Централизованный сбор логов через сторонние сервисы: Вместо создания и поддержки собственной системы сбора логов можно воспользоваться сторонними сервисами, предоставляющими инструменты для централизованного сбора и анализа логов. Некоторые популярные сервисы, такие как Splunk, ELK Stack (Elasticsearch, Logstash, Kibana), Fluentd, предоставляют бесплатные или условно бесплатные решения для сбора и анализа логов.
Настройка мониторинга ошибок через метрики: Вместо логирования событий можно настроить мониторинг ошибок через метрики, например, с помощью метрик HTTP кодов ответов сервера. Это позволит оперативно выявлять проблемы и уведомлять разработчиков о них без необходимости настройки и поддержки сложной системы сбора логов.
Эти решения позволят разработчикам оперативно получать информацию об ошибках приложения, не требуя больших затрат на построение и поддержку системы сбора логов.

4 . Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. 
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?
## Ответ 4
Если параметр SLA = 99% по HTTP-кодам ответов не поднимается выше 70%, но при этом в системе нет кодов ответа 5xx и 4xx, то ошибка скорее всего связана с неправильным вычислением SLA.В данном случае, формула для расчета SLA = 99% (summ_2xx_requests / summ_all_requests) не учитывает другие возможные HTTP-коды ответов, такие как 3xx (редиректы) или даже 1xx (информационные ответы). Для корректного вычисления SLA необходимо учитывать все категории HTTP-кодов ответов, а не только успешные (2xx).Поэтому для исправления ошибки необходимо пересмотреть формулу расчета SLA, включив в неё все категории HTTP-кодов ответов. Например:SLA = (количество успешных запросов / общее количество запросов) * 100%Где "успешные запросы" включают в себя все HTTP-коды ответов, не только 2xx. После коррекции формулы следует пересчитать SLA и убедиться, что он отображает реальное выполнение сервисного уровня.

#
5. Опишите основные плюсы и минусы pull и push систем мониторинга.
## ОТВЕТ 5


Push система мониторинга:

Плюсы:

Мгновенное уведомление: Поскольку данные непрерывно отправляются на сервер мониторинга, аналитика и уведомления могут быть мгновенными, что позволяет оперативно реагировать на проблемы.
Низкая нагрузка на целевую систему: Целевая система (например, серверы) не обязана активно запрашивать сервер мониторинга, что снижает нагрузку на нее.
Удобство настройки: Пользователи могут легко настроить отправку данных на сервер мониторинга с помощью агентов или API.
Минусы:

Проблемы с масштабированием: При высокой нагрузке на сервер мониторинга могут возникнуть проблемы с производительностью из-за постоянного потока данных.
Потенциальные потери данных: Если соединение между целевой системой и сервером мониторинга оборвется, данные могут быть потеряны.
Безопасность: При использовании push-метода может возникнуть необходимость обеспечить безопасность канала передачи данных.
Pull система мониторинга:

Плюсы:

Более гибкий контроль: Система мониторинга сама решает, когда запрашивать данные, что позволяет лучше контролировать использование ресурсов.
Управление трафиком: При использовании pull-метода можно более эффективно управлять трафиком, особенно в случае большого количества целевых систем.
Более простая интеграция: Некоторые системы могут быть проще интегрировать с pull-методом, особенно если внедрение агентов на целевые системы вызывает сложности.
Минусы:

Задержка в обновлении данных: Поскольку сервер мониторинга запрашивает данные с целевой системы, может возникнуть задержка в обновлении информации, особенно если интервалы опроса долгие.
Повышенная нагрузка на целевую систему: Целевая система должна обрабатывать запросы на предоставление данных, что может повлечь за собой дополнительную нагрузку.
Сложности с масштабированием: При большом количестве целевых систем может быть сложно управлять запросами на данные и обеспечить масштабируемость системы мониторинга.
Выбор между push и pull системами мониторинга зависит от конкретных потребностей и требований к системе мониторинга, а также от особенностей целевой инфраструктуры.

6. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

    - Prometheus 
    - TICK
    - Zabbix
    - VictoriaMetrics
    - Nagios
## ОТВЕТ 6
Prometheus
Модель: Pull
Описание: Prometheus в основном использует pull-модель, где сервер Prometheus запрашивает данные у экспортёров по HTTP. Однако, существуют механизмы, такие как pushgateway, которые позволяют реализовать push-модель для краткосрочных задач или при невозможности использовать pull.
TICK (Telegraf, InfluxDB, Chronograf, Kapacitor)
Модель: Гибридная
Описание: TICK-стек в основном использует push-модель. Telegraf (агент) собирает метрики и отправляет их в InfluxDB (хранилище данных). Тем не менее, Telegraf может также выступать в роли pull-агента, собирая данные из различных источников.
Zabbix
Модель: Гибридная
Описание: Zabbix поддерживает обе модели. Он может активно опрашивать (pull) агенты и устройства, а также принимать данные, отправленные агентами (push).
VictoriaMetrics
Модель: Гибридная
Описание: VictoriaMetrics в основном использует pull-модель, аналогично Prometheus, запрашивая метрики у экспортёров. Тем не менее, она также поддерживает push-модель через механизмы, совместимые с Prometheus, такие как Prometheus remote write.
Nagios
Модель: Pull
Описание: Nagios в основном использует pull-модель. Центральный сервер Nagios опрашивает агенты или сервисы для получения данных о состоянии.
Итог:
Pull-модель: Prometheus, Nagios
Push-модель:

7. Склонируйте себе [репозиторий](https://github.com/influxdata/sandbox/tree/master) и запустите TICK-стэк, 
используя технологии docker и docker-compose.

В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (`http://localhost:8888`). 

P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим `Z`, например
`./data:/var/lib:Z`
## ОТВЕТ 7



8. Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer.
        
    - Нажмите на кнопку Add a query
    - Изучите вывод интерфейса и выберите БД telegraf.autogen
    - В `measurments` выберите cpu->host->telegraf-getting-started, а в `fields` выберите usage_system. Внизу появится график утилизации cpu.
    - Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.

Для выполнения задания приведите скриншот с отображением метрик утилизации cpu из веб-интерфейса.
## ОТВЕТ 8


#
9. Изучите список [telegraf inputs](https://github.com/influxdata/telegraf/tree/master/plugins/inputs). 
Добавьте в конфигурацию telegraf следующий плагин - [docker](https://github.com/influxdata/telegraf/tree/master/plugins/inputs/docker):
```
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
```

Дополнительно вам может потребоваться донастройка контейнера telegraf в `docker-compose.yml` дополнительного volume и 
режима privileged:
```
  telegraf:
    image: telegraf:1.4.0
    privileged: true
    volumes:
      - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
      - /var/run/docker.sock:/var/run/docker.sock:Z
    links:
      - influxdb
    ports:
      - "8092:8092/udp"
      - "8094:8094"
      - "8125:8125/udp"
```

После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список `measurments` в 
веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.

    
## ОТВЕТ 9

